\subsection{Modulo de comunicación}

	Si consideramos la lista de elementos dinámicos y cada estado que pueden admitir, es claro que la cantidad de señales sobrepasaría por mucho la limitada cantidad de puertos que una FPGA pueda proveer. Es por eso que se decidió que la información deberá ser recibida por la FPGA y transmitida desde la FPGA en formato serie. El formato serie es ampliamente utilizado en las redes ferroviarias, por ejemplo RS-485 o MVB en las redes de comunicación de trenes  TCN [REF]. Esta comunicación deberá ser flexible para ser utilizada en diferentes implementaciones con menor o mayor demanda de recursos.
	
	En la Figura \ref{fig:GeneralCom} se presenta la propuesta de conexión de la FPGA con una computadora externa, junto con los módulos internos de comunicación.	La UART (del inglés \textit{Universal Asynchronous Receiver-Transmitter}) es la unidad encargada de recibir y transmitir las tramas de datos entre la FPGA y la computadora.
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=1\textwidth]{example-image}
		\centering\caption{FPGA.}
		\label{fig:GeneralCom}
	\end{figure}
	
	El bloque de recepción UART es el encargado de procesar las tramas con un baudrate preestablecido y almacenar el valor de la trama en la FIFO de entrada. La trama será enviada al sistema de enclavamientos, junto con una serie de pulsos para indicar cuándo deben ser leídos. El sistema de enclavamientos la procesará y devolverá una nueva trama a la FIFO de salida. Finalmente la nueva trama será enviada a la UART de tramisión que enviará la información con el mismo baudrate que fue recibido.
		
	En la Figura \ref{fig:Stream} se ilustra el formato definido para las tramas de entrada y salida. La trama tendrá un tamaño de entrada N y de salida M, con N menor que M, debido a que el estado de ocupación de las vías es de sólo lectura. Además, la trama tendrá un caracter delimitador de entrada y de salida ($<$ y $>$ respectivamente). Todos los elementos de la trama serán en formato ASCII, para poder ser interpretados fácilmente en una terminal y ser menos susceptibles a errores por alteraciones en algún bit aleatorio.
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=1\textwidth]{Figuras/Tramas.png}
		\centering\caption{Tramas de entrada y salida.}
		\label{fig:Stream}
	\end{figure}
	
	De la lista de estados de cada elemento dinámico dado anteriormente se deduce que cada elemento requiere un sólo caractér para definir su estado, salvo los semáforos y cambios de vías dobles, que necesitan dos caracteres. Por lo tanto, el largo de la trama de entrada y de salida queda definido por la Fórmula \ref{eq:StreamLength_in} y la Fórmula \ref{eq:StreamLength_out}, respectivamente.
	
	\begin{equation} 
		\label{eq:StreamLength_in}
		\text{N} = 1\text{bit} (\text{N}_{NET}+\text{N}_{\text{RTS}}+\text{N}_{\text{LCB}}+\text{N}_{\text{SSW}}+\text{N}_{\text{SCR}})+2\text{bits} (\text{N}_{\text{SIG}}+\text{N}_{\text{DSW}})
	\end{equation}
	
	\begin{equation} 
		\label{eq:StreamLength_out}
		\text{M} = 1\text{bit} (\text{N}_{\text{RTS}}+\text{N}_{\text{LCB}}+\text{N}_{\text{SSW}}+\text{N}_{\text{SCR}})+2\text{bits} (\text{N}_{\text{SIG}}+\text{N}_{\text{DSW}})
	\end{equation}
	
	La implementación de los módulos de transmisión y recepción de la UART es invariante para cada locación, es decir, los recursos asignados serán los mismos, cualquiera sea el tamaño del sistema a implementar. Los módulos de memorias FIFO, en cambio, dependen de las características y del tamaño del sistema. Locaciones mas complejas tendrán valores de N y M mayores y, por lo tanto, requerirán FIFOs mas grandes. 
	
	Con este criterio de diseño, en todos los demás casos, la FIFO de salida tendrá el mismo tamaño que la FIFO de entrada o a lo sumo será 50 \% menor, lo que representa un ahorro de 25 \% de los recursos estimados. Por ejemplo, si se necesita que la entrada tenga 15 bits y la salida 7 bits y se le asignara el mismo tamaño a ambas FIFOs; tanto la FIFO de entrada como la de salida necesitarán 16 bits cada una, dando un total de 32 bits. Pero si se aplica el criterio de tamaños desacoplados, entonces para la FIFO de salida podrían asignarse solamente 8 bits,
	dando un total de 24 bits, un 25 \% menos que los 32 bits que necesitaría si ambas FIFOs quedaran definidas según los datos de la entrada.
	
\input{ACG/arquitectura/detector}
\input{ACG/arquitectura/decoder}
\input{ACG/arquitectura/encoder}
\input{ACG/arquitectura/printer}
\input{ACG/arquitectura/selector}